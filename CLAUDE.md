# Project Guidelines

## Context

The Google Fonts project stores binary font files (.ttf) in the `google/fonts` repository (https://github.com/google/fonts). Each of these files was at some point generated by a font engineer through a compilation process from source project files stored in upstream repositories.

### Terminology

- **google/fonts**: Refers to https://github.com/google/fonts - the main repository containing compiled font binaries
- **upstream repos**: Source repositories containing font project files (`.glyphs`, `.ufo`, `.designspace`, etc.) from which the binary fonts are compiled
- **METADATA.pb**: Protocol buffer files in google/fonts that document font metadata, including the `repository_url` field pointing to upstream repos

### Why Commit Hashes Matter

When fonts are compiled from upstream repos, there is a risk that type designers may have made additional changes after the last time fonts were added or updated in the Google Fonts catalog. Therefore, it is critical to reference the exact commit hashes that were originally used for onboarding.

Any additional work done in upstream repos after the recorded commit will need to go through a separate review and quality assurance process before being incorporated into Google Fonts.

### Goals

1. **Primary goal**: Collect 100% of upstream repository URLs and document them in the corresponding `METADATA.pb` files
2. Verify that `repository_url` fields point to valid repositories
3. Verify that commit hashes in METADATA.pb match the commits originally used for onboarding (not newer commits)
4. Verify that upstream repos have a `config.yaml` file with gftools-builder configuration

### Build Configuration (config.yaml)

Upstream repositories must have a `config.yaml` file containing gftools-builder configuration. The location of this file (relative to the repo root) must be set in the `config_yaml` field inside the `source { ... }` block of `METADATA.pb`.

Alternatively, an overriding `config.yaml` can be provided directly in the family directory within the google/fonts repository.

### Fixing Missing or Incorrect Data

When data is missing or incorrect (e.g., missing config.yaml, missing commit hash, wrong repository_url), we should:

1. **Determine correct settings**: Based on investigation of upstream repos, PR history, and font structure
2. **Prepare a PR to google/fonts**: Fix the data directly in google/fonts repository
3. **Use override files when needed**: Since upstream repos may not respond quickly (or at all), we can maintain override `config.yaml` files in google/fonts

PRs to be created are tracked in `data/pending_prs.json` and displayed in the dashboard.

### Validation Strategies

To identify the original onboarding commits, we can use the following approaches:

1. **Check binary file history**: Look at the commit history of the .ttf files in google/fonts to identify the last commit that modified them
2. **Analyze commit messages**: Check if the commit message contains useful information (upstream repo URL, commit hash, PR reference)
3. **Trace linked PRs**: If the commit is linked to a pull request, read the full PR history for additional context and references to upstream sources

### Pending Questions

When there is uncertainty about what actually happened during onboarding, and we need to ask questions to the people involved, save the question to `data/pending_questions.json`. Questions should be grouped by the person (designer or font engineer) best positioned to provide a good answer.

## Language

All code, comments, documentation, and commit messages must be in English.

## Commit Policy

Make commits frequently, whenever any small progress is achieved. Keep commits granular and atomic.

## Tech Stack

- Static site (HTML, CSS, vanilla JavaScript)
- No build tools or frameworks
- Must be compatible with GitHub Pages

## Message Logging

All user messages must be logged to `data/message_log.json` with timestamp and verbatim content. Append new messages to the array as they are received.

## Development

Run locally with `./run.sh` (uses Python's http.server).
